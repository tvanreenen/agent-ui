<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent UI - AG-UI Demo</title>
    <link rel="stylesheet" href="demo.css">
    <script src="demo.js"></script>
    <script src="agent-ui.js"></script>
</head>
<body>
    <div class="container">
        <div class="demo-section">
            <h2>AG-UI</h2>
            <p>This demo showcases the Agent UI widget's flexible event-driven architecture that works seamlessly with the AG-UI protocol.</p>
            <p>The widget was built with an open event/callback design that makes it highly adaptable. I've included HttpEvents objects from the <a href="https://github.com/ag-ui-protocol/ag-ui" target="_blank">AG-UI protocol</a> for the cleanest and easiest interaction with APIs that implement the AG-UI protocol, but you can implement it any way you'd like.</p>
            <p>As you can see in the source code below, the widget listens for various AG-UI events like <code>onRunStartedEvent</code>, <code>onTextMessageContentEvent</code>, <code>onToolCallStartEvent</code>, and more to provide real-time updates to the user interface.</p>
            <p>To get this demo working, simply provide the local or public URL to your AG-UI API endpoint in the configuration below.</p>
        </div>
    </div>

    <agent-ui placeholder-text="Ask me anything..."></agent-ui>
    
    <script>
        const widget = document.querySelector('agent-ui');
        widget.conversationTitle = 'AG-UI Demo';
        
        const agent = widget.configureHttpAgent({
            url: 'http://example.com',
            headers: { 'Authorization': 'Bearer demo-key' }
        });
        
        widget.addEventListener('message', async (e) => {
            // Generate runId (in a real app, this would come from your app state)
            const runId = `run_${Date.now()}`;
            
            // Add the user message to the agent's conversation history
            agent.messages.push({
                id: `msg_${Date.now()}`,
                role: 'user',
                content: e.detail.query
            });
            
            try {
                // Run the agent with proper parameters
                const result = await agent.runAgent({
                    runId,
                    tools: [], // Add any tools you want to make available
                    context: [], // Add any context you want to pass
                    forwardedProps: {
                        // Any additional properties you want to forward
                    }
                }, {
                    // Event subscriber for handling streaming events
                    onRunStartedEvent: ({ event }) => {
                        console.log('AG-UI event:', event);
                        widget.setTyping(true);
                        widget.setSubmittable(false);
                    },
                    onTextMessageStartEvent: ({ event }) => {
                        console.log('AG-UI event:', event);
                        widget.appendToLastMessage('');
                    },
                    onTextMessageContentEvent: ({ event, textMessageBuffer }) => {
                        console.log('AG-UI event:', event);
                        widget.appendToLastMessage(event.delta);
                    },
                    onTextMessageEndEvent: ({ event, textMessageBuffer }) => {
                        console.log('AG-UI event:', event);
                    },
                    onToolCallStartEvent: ({ event }) => {
                        console.log('AG-UI event:', event);
                        widget.appendToLastMessage(`üîß Calling tool: ${event.toolCallName}\n\n`);
                    },
                    onToolCallResultEvent: ({ event }) => {
                        console.log('AG-UI event:', event);
                        widget.appendToLastMessage(`‚úÖ Tool result: ${event.content}\n\n`);
                    },
                    onRunFinishedEvent: ({ event, result }) => {
                        console.log('AG-UI event:', event);
                        widget.setTyping(false);
                        widget.setSubmittable(true);
                    },
                    onRunErrorEvent: ({ event }) => {
                        console.log('AG-UI event:', event);
                        widget.setTyping(false);
                        widget.setSubmittable(true);
                        widget.appendToLastMessage(`‚ùå Error: ${event.message}\n\n`);
                    }
                });
                
                console.log('Agent run completed:', result);
                
            } catch (error) {
                console.error('Agent error:', error);
                widget.setTyping(false);
                widget.setSubmittable(true);
                widget.appendToLastMessage(`‚ùå Error: ${error.message}`);
            }
        });
    </script>
</body>
</html> 